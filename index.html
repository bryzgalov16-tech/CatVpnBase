<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Подключить VPN</title>
    <style>
        body { font-family: -apple-system, sans-serif; display: flex; align-items: center; justify-content: center; height: 100vh; background-color: #f4f4f9; margin: 0; }
        .container { background: white; padding: 2rem; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); text-align: center; width: 90%; max-width: 350px; }
        h1 { font-size: 1.3rem; color: #333; margin-bottom: 20px; }
        
        .main-btn { 
            display: block; width: 100%; padding: 16px; background-color: #007aff; color: white; 
            border: none; border-radius: 12px; font-size: 1.1rem; font-weight: bold; 
            cursor: pointer; text-decoration: none; transition: background 0.3s;
        }
        .main-btn:active { background-color: #0056b3; transform: scale(0.98); }
        
        .status-text { margin-top: 15px; font-size: 0.85rem; color: #8e8e93; line-height: 1.4; }
        .copy-link { margin-top: 20px; background: none; border: none; color: #007aff; cursor: pointer; font-size: 0.9rem; }
    </style>
</head>
<body>

<div class="container">
    <h1>Настройка VPN</h1>
    
    <button onclick="smartImport()" class="main-btn">Импортировать подписку</button>
    
    <p class="status-text" id="status">
        Сначала попробуем открыть <b>Happ</b>.<br> 
        Если он не установлен, предложим <b>v2raytun</b>.
    </p>

    <button onclick="copyToClipboard()" class="copy-link">Копировать ссылку вручную</button>
</div>

<script>
    const rawUrl = "https://gist.githubusercontent.com/bryzgalov16-tech/e65d559af250502452f97db4f159e873/raw/general.txt#Cat_VPN_Main";

    function smartImport() {
        const status = document.getElementById('status');
        const happLink = "happ://add/" + rawUrl;
        const v2rayLink = "v2raytun://import/" + rawUrl;

        status.innerHTML = "Запуск Happ...";
        
        // 1. Пытаемся открыть Happ
        window.location.href = happLink;

        // 2. Через 2 секунды проверяем, ушел ли пользователь со страницы
        // Если приложение открылось, таймер может замедлиться или не сработать (зависит от ОС)
        // Но в большинстве случаев это сработает как запасной вариант
        setTimeout(() => {
            if (!document.hidden) {
                status.innerHTML = "Happ не найден. Пробуем v2raytun...";
                window.location.href = v2rayLink;
            }
        }, 2000);
    }

    function copyToClipboard() {
        navigator.clipboard.writeText(rawUrl).then(() => {
            alert("Ссылка скопирована!");
        });
    }
</script>

</body>
</html>
